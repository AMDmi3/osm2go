#
# Copyright (C) 2008 Till Harbaum <till@harbaum.org>.
#
# This file is part of OSM2Go.
#
# OSM2Go is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# OSM2Go is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with OSM2Go.  If not, see <http://www.gnu.org/licenses/>.
#

APP = @PACKAGE@
prefix = @prefix@
datadir = @datarootdir@
VERSION = $${VERSION_PREFIX}@PACKAGE_VERSION@$${VERSION_SUFFIX}
MAEMO_VERSION_MAJOR = @MAEMO_VERSION_MAJOR@

bindir = @bindir@
srcdir = @srcdir@

OBJS = main.o map.o osm.o osm_api.o wms.o about.o \
	statusbar.o project.o settings.o pos.o diff.o map_hl.o \
	iconbar.o info.o icon.o track.o canvas_goocanvas.o \
	area_edit.o josm_presets.o relation_edit.o misc.o map_edit.o \
	josm_elemstyles.o style.o net_io.o banner.o undo.o canvas.o \
	list.o scale_popup.o \
	@EXTRA_OBJS@

DEFS = -DPACKAGE=\"$(APP)\" -DPREFIX=\"@prefix@\" -DDATADIR=\"$(datadir)/$(APP)\" -DVERSION=\"$(VERSION)\"
CC = @CC@
CFLAGS = -Wall $(DEFS) -I$(srcdir) @CFLAGS@ -DCANVAS_CUSTOM_ITEM_AT
LDFLAGS = @LIBS@

all: $(APP)

%.o: $(srcdir)/%.c Makefile
	$(CC) $(CFLAGS) -o $@ -c $<

$(APP): $(OBJS) Makefile
	$(CC) -o $@ $(OBJS) $(LDFLAGS)

clean:
	rm -f $(APP) *.o *~ */*~ \#*\# version.h *.bak

install: $(APP)
	install -d $(DESTDIR)$(prefix)$(bindir)
	if [ "$(MAEMO_VERSION_MAJOR)" == "5" ]; then \
		echo "Optifying binary"; \
		install -d $(DESTDIR)$(datadir)/$(APP); \
		install $(APP) $(DESTDIR)$(datadir)/$(APP)/$(APP).bin; \
		ln -sf $(datadir)/$(APP)/$(APP).bin $(DESTDIR)$(prefix)$(bindir)/$(APP); \
	else \
		echo "Not Optifying binary"; \
		install $(APP) $(DESTDIR)$(prefix)$(bindir); \
	fi

dep:
	makedepend -Y -fMakefile.in *.c
	sed -r '/^[a-z][-a-z_0-9]*\.o:( [-_a-z0-9]+\.h)+$$/s, ([^ ]*\.h), $$(srcdir)/\1,g' -i Makefile.in

# DO NOT DELETE

about.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h $(srcdir)/project.h
about.o: $(srcdir)/icon.h $(srcdir)/misc.h
area_edit.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h $(srcdir)/project.h
area_edit.o: $(srcdir)/area_edit.h $(srcdir)/gps.h $(srcdir)/misc.h
banner.o: $(srcdir)/banner.h $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h
banner.o: $(srcdir)/project.h $(srcdir)/statusbar.h
canvas.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h $(srcdir)/project.h
canvas_goocanvas.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h
canvas_goocanvas.o: $(srcdir)/project.h
converter.o: $(srcdir)/osm-gps-map-types.h $(srcdir)/osm-gps-map.h $(srcdir)/config.h $(srcdir)/converter.h
dbus.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h $(srcdir)/project.h
diff.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h $(srcdir)/project.h
diff.o: $(srcdir)/diff.h $(srcdir)/misc.h $(srcdir)/statusbar.h
gps.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h $(srcdir)/project.h $(srcdir)/gps.h
gps_liblocation.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h
gps_liblocation.o: $(srcdir)/project.h
iconbar.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h $(srcdir)/project.h
iconbar.o: $(srcdir)/icon.h $(srcdir)/iconbar.h $(srcdir)/info.h $(srcdir)/map_edit.h
icon.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h $(srcdir)/project.h
icon.o: $(srcdir)/icon.h $(srcdir)/misc.h
info.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h $(srcdir)/project.h
info.o: $(srcdir)/info.h $(srcdir)/josm_presets.h $(srcdir)/list.h $(srcdir)/misc.h $(srcdir)/relation_edit.h
josm_elemstyles.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h
josm_elemstyles.o: $(srcdir)/project.h $(srcdir)/josm_elemstyles.h $(srcdir)/josm_presets.h $(srcdir)/info.h $(srcdir)/misc.h
josm_elemstyles.o: $(srcdir)/style.h $(srcdir)/icon.h
josm_presets.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h
josm_presets.o: $(srcdir)/project.h $(srcdir)/icon.h $(srcdir)/josm_presets.h $(srcdir)/info.h $(srcdir)/misc.h
list.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h $(srcdir)/project.h
list.o: $(srcdir)/list.h $(srcdir)/misc.h
main.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h $(srcdir)/project.h
main.o: $(srcdir)/about.h $(srcdir)/banner.h $(srcdir)/diff.h $(srcdir)/gps.h $(srcdir)/iconbar.h $(srcdir)/josm_presets.h $(srcdir)/info.h $(srcdir)/misc.h
main.o: $(srcdir)/osm_api.h $(srcdir)/relation_edit.h $(srcdir)/scale_popup.h $(srcdir)/statusbar.h $(srcdir)/style.h $(srcdir)/icon.h
main.o: $(srcdir)/josm_elemstyles.h $(srcdir)/track.h $(srcdir)/wms.h
map.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h $(srcdir)/project.h
map.o: $(srcdir)/banner.h $(srcdir)/diff.h $(srcdir)/iconbar.h $(srcdir)/info.h $(srcdir)/map_edit.h $(srcdir)/map_hl.h $(srcdir)/misc.h
map.o: $(srcdir)/statusbar.h $(srcdir)/style.h $(srcdir)/icon.h $(srcdir)/josm_elemstyles.h $(srcdir)/track.h
map_edit.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h $(srcdir)/project.h
map_edit.o: $(srcdir)/banner.h $(srcdir)/iconbar.h $(srcdir)/info.h $(srcdir)/map_hl.h $(srcdir)/misc.h $(srcdir)/statusbar.h $(srcdir)/style.h
map_edit.o: $(srcdir)/icon.h $(srcdir)/josm_elemstyles.h
map_hl.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h $(srcdir)/project.h
map_hl.o: $(srcdir)/map_hl.h $(srcdir)/style.h $(srcdir)/icon.h $(srcdir)/josm_elemstyles.h
misc.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h $(srcdir)/project.h
misc.o: $(srcdir)/misc.h
net_io.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h $(srcdir)/project.h
net_io.o: $(srcdir)/banner.h $(srcdir)/misc.h $(srcdir)/net_io.h
osm_api.o: $(srcdir)/osm_api.h $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h
osm_api.o: $(srcdir)/project.h $(srcdir)/diff.h $(srcdir)/misc.h $(srcdir)/net_io.h
osm.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h $(srcdir)/project.h
osm.o: $(srcdir)/banner.h $(srcdir)/icon.h $(srcdir)/misc.h
osm-gps-map.o: $(srcdir)/config.h $(srcdir)/converter.h $(srcdir)/osm-gps-map-types.h $(srcdir)/osm-gps-map.h $(srcdir)/misc.h
osm-gps-map-osd-select.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h
osm-gps-map-osd-select.o: $(srcdir)/map.h $(srcdir)/project.h $(srcdir)/config.h $(srcdir)/osm-gps-map.h $(srcdir)/converter.h
osm-gps-map-osd-select.o: $(srcdir)/osm-gps-map-osd-select.h
pos.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h $(srcdir)/project.h
pos.o: $(srcdir)/misc.h
project.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h $(srcdir)/project.h
project.o: $(srcdir)/area_edit.h $(srcdir)/banner.h $(srcdir)/diff.h $(srcdir)/gps.h $(srcdir)/list.h $(srcdir)/misc.h $(srcdir)/osm_api.h
project.o: $(srcdir)/statusbar.h $(srcdir)/track.h $(srcdir)/wms.h
relation_edit.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h
relation_edit.o: $(srcdir)/project.h $(srcdir)/info.h $(srcdir)/list.h $(srcdir)/misc.h $(srcdir)/relation_edit.h
scale_popup.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h
scale_popup.o: $(srcdir)/project.h
settings.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h $(srcdir)/project.h
settings.o: $(srcdir)/wms.h
statusbar.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h $(srcdir)/project.h
statusbar.o: $(srcdir)/statusbar.h
style.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h $(srcdir)/project.h
style.o: $(srcdir)/misc.h $(srcdir)/style.h $(srcdir)/icon.h $(srcdir)/josm_elemstyles.h
track.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h $(srcdir)/project.h
track.o: $(srcdir)/banner.h $(srcdir)/gps.h $(srcdir)/misc.h $(srcdir)/track.h
undo.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h $(srcdir)/project.h
undo.o: $(srcdir)/banner.h
wms.o: $(srcdir)/appdata.h $(srcdir)/pos.h $(srcdir)/osm.h $(srcdir)/canvas.h $(srcdir)/undo.h $(srcdir)/settings.h $(srcdir)/map.h $(srcdir)/project.h
wms.o: $(srcdir)/list.h $(srcdir)/misc.h $(srcdir)/net_io.h $(srcdir)/wms.h
